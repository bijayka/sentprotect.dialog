<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EY Sent Protect</title>
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/beta/hosted/office.js"></script>
    <script type="text/javascript">
        //document.getElementById("addInformational").addEventListener("click", addInformational);
        Office.onReady((info) => {
            function onMessageSendHandler(event) {
                const id = document.getElementById("notificationId")?.value || "";
          const details =
            {
              type: Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,
              message: "Non-persistent informational notification message with id = " + id,
              icon: "PG.Icon.16",
              persistent: false
            };
          Office.context.mailbox.item.notificationMessages.addAsync(id, details, handleResult);
                // const myPartitionKey = Office.context.partitionKey;
                // console.log("myPartitionKey : " + myPartitionKey);
                // const forceSend = getFromLocalStorage('forceSend');
                // const id = "eySentProtectMessage";

                // const itemId = Office.context.mailbox.item.itemId;
                // const details = {
                // type: Office.MailboxEnums.ItemNotificationMessageType.InsightMessage,
                // message: "Your email includes recipients outside of your organization. Please review before sending?",
                // icon: "Icon.16x16",
                // actions: [
                //     {
                //         actionText: "Review",
                //         actionType: Office.MailboxEnums.ActionType.ShowTaskPane,
                //         commandId: "msgComposeOpenPaneButton"
                //     }
                //     ]
                // };

                // Office.context.mailbox.item.notificationMessages.addAsync(id, details, handleResult);
            }
            Office.actions.associate("onMessageSendHandler", onMessageSendHandler);
        });

        function addInformational() {
          // Adds an informational notification to the mail item.
          const id = document.getElementById("notificationId")?.value || "";
          const details =
            {
              type: Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,
              message: "Non-persistent informational notification message with id = " + id,
              icon: "PG.Icon.16",
              persistent: false
            };
          Office.context.mailbox.item.notificationMessages.addAsync(id, details, handleResult);
        }

        function handleResult(asyncResult) {
            if (asyncResult.status === Office.AsyncResultStatus.Succeeded) {
                console.log("Notification message added successfully.");
            } else {
                console.log("Error adding notification message: " + asyncResult.error.message);
            }
        }

        function sendEmail() {
            // setInLocalStorage('forceSend', 'true');
            // Office.context.mailbox.item.sendAsync((sendResult) => {
            //     setInLocalStorage('forceSend', 'false');
            // });
        }
        function cancelEmail() {
        
        }
        function setInLocalStorage(key, value) {
            const myPartitionKey = Office.context.partitionKey;
            if (myPartitionKey) {
                localStorage.setItem(myPartitionKey + key, value);
            } else {
                localStorage.setItem(key, value);
            }
        }

        function getFromLocalStorage(key) {
            const myPartitionKey = Office.context.partitionKey;

            if (myPartitionKey) {
                return localStorage.getItem(myPartitionKey + key);
            } else {
                return localStorage.getItem(key);
            }
        }
    </script>
</head>

<body>
    <button onclick="sendEmail()" class="send">Send</button>
    <button onclick="cancelEmail()" class="cancel">Cancel</button>
    <button id="addInformational" class="ms-Button">
        <div class="ms-Button-label">Add an informational notification</div>
    </button>
</body>
</html>